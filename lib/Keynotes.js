!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash.isfunction"),require("lodash.clonedeep"),require("lodash.clonedeepwith"),require("lodash.clone"),require("lodash.difference"),require("lodash.isplainobject"),require("lodash.isstring"),require("lodash.find")):"function"==typeof define&&define.amd?define("keynotes",["lodash.isfunction","lodash.clonedeep","lodash.clonedeepwith","lodash.clone","lodash.difference","lodash.isplainobject","lodash.isstring","lodash.find"],t):"object"==typeof exports?exports.keynotes=t(require("lodash.isfunction"),require("lodash.clonedeep"),require("lodash.clonedeepwith"),require("lodash.clone"),require("lodash.difference"),require("lodash.isplainobject"),require("lodash.isstring"),require("lodash.find")):e.keynotes=t(e["lodash.isfunction"],e["lodash.clonedeep"],e["lodash.clonedeepwith"],e["lodash.clone"],e["lodash.difference"],e["lodash.isplainobject"],e["lodash.isstring"],e["lodash.find"])}(window,function(e,t,n,r,o,i,a,s){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(5),i=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.object3D=Array.isArray(n)?n:[n],this._isPlural=!!Array.isArray(n)}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"getObject",value:function(){return this._isPlural?this.object3D:this.object3D[0]}},{key:"getObjectAsArray",value:function(){return this.object3D}},{key:"clone",value:function(){return new e("__clone__".concat(this.name),o(this.getObject()))}}]),e}();e.exports=i},function(e,t,n){function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=n(2),c=n(6),f=(n(7),n(8)),l=n(9),h=n(3),d=function(){function e(t,n){var s=this,f=n.object_options,l=n.beforeBuild,h=n.afterDestroy;a(this,e);var d=Object.keys(f);d.map(function(t){e.validateSpec(f[t])}),this.beforeBuild=u(l)?l:function(){},this.afterDestroy=u(h)?h:function(){},this._split={start:{},end:{}},this._split_records={},this.transition_duration=0,this.segments=[],d.map(function(e){s.computeSplit(e,f[e])});var y=Object.keys(this._split_records).sort(function(e,t){return-1===Number(e)?1:-1===Number(t)?-1:Number(e)<Number(t)?-1:Number(e)>Number(t)?1:0}),m={},b=y[0];this._split.start[b].map(function(e){var t=i(e,3),n=t[0],a=t[1],s=t[2];m[n]=r({},m[n],o({},a,new p(s)))}),y.slice(1).map(function(e){s.segments.push({start:b,end:e,object_prop_spec:c(m,function(e){if(e instanceof p)return e})}),b=e,s._split.end.hasOwnProperty(e)&&s._split.end[e].map(function(e){var t=i(e,3),n=t[0],r=t[1];t[2];delete m[n][r],0===Object.keys(m[n]).length&&delete m[n]}),s._split.start.hasOwnProperty(e)&&s._split.start[e].map(function(e){var t=i(e,3),n=t[0],a=t[1],s=t[2];m[n]=r({},m[n],o({},a,new p(s)))})}),this.name=t,this.object_options=f}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(e,[{key:"computeSplit",value:function(e,t){var n=this;Object.keys(t).map(function(r){t[r].map(function(t){n._split.start.hasOwnProperty(t.start)||(n._split.start[t.start]=[]),n._split.end.hasOwnProperty(t.end)||(n._split.end[t.end]=[]),n._split_records[t.start]=1,n._split_records[t.end]=1,n._split.start[t.start].push([e,r,t]),n._split.end[t.end].push([e,r,t]),n.transition_duration=Math.max(n.transition_duration,t.end)})})}},{key:"getSegmentIdx",value:function(e){return h(this.segments,e,function(e,t){var n=e.start,r=e.end;return n<=t&&(t<r||r<0)?0:t<n?-1:1})}},{key:"seek",value:function(e,t){var n=this,r=this.getSegmentIdx(e);if(-1!==r){var o=this.segments[r].object_prop_spec;Object.keys(o).map(function(r){Object.keys(o[r]).map(function(i){try{t[r].getObjectAsArray().map(function(t,a){var s=o[r][i].spec,u=i.split(".");n.calculateAnimation(e,s,u,t,a)})}catch(e){throw console.log(t,r,o[r]),e}})})}}},{key:"handleAssignMap",value:function(e,t,n){if(e instanceof Map)e.set(t,n);else if(u(e[t]))try{e[t].apply(e,n)}catch(n){console.error(n),console.log(e,t)}else try{e[t]=n}catch(n){console.error(n),console.log(e,t)}}},{key:"calculateAnimation",value:function(e,t,n,r,o){for(var i=t.start,a=t.end,s=t.from,c=t.to,f=t.easing,h=r,d=0;d<n.length;d++){if(void 0===h[n[d]]&&(void 0===h.get||void 0===h.get(n[d]))&&d!=n.length-1)throw console.error("Object does not have property: ".concat(n.join("-"))),"Object does not have property: ".concat(n.join("-"));d<n.length-1&&(h=h[n[d]]||h.get(n[d]))}var p=a-i,y=e-i,m=s,b=c;if(u(s)&&(m=s(y,r,o,this.transition_duration)),u(c)&&(b=c(y,r,o,this.transition_duration,m)),0===y)this.handleAssignMap(h,n[n.length-1],m);else if(t.hasOwnProperty("easing"))if(u(f))this.handleAssignMap(h,n[n.length-1],f(y,m,b-m,p,o));else if(l.hasOwnProperty(f))this.handleAssignMap(h,n[n.length-1],l[f](y,m,b-m,p));else if(!0===f)this.handleAssignMap(h,n[n.length-1],(b-m)/p*y+m);else{if(!1!==f)throw console.error("Defined easing does not match: function or string"),"Defined easing does not match: function or string";this.handleAssignMap(h,n[n.length-1],b)}else this.handleAssignMap(h,n[n.length-1],(b-m)/p*y+m);if(Number.isNaN(h[n[n.length-1]]))throw console.error(h,val),"nan"}},{key:"toString",value:function(){return this.name}}],[{key:"validateSpec",value:function(e){Object.keys(e).map(function(t){if(!Array.isArray(e[t])||0===e[t].length)throw console.error("Given animation spec should be non-empty array."),"Given animation spec should be non-empty array.";e[t].reduce(function(e,t){if(f(["start","end","from","to"],Object.keys(t)).length>0)throw console.error("Keys are required: ".concat(["start","end","from","to"].join(", "),". (Given key: ").concat(Object.keys(t).join(", "),")")),"Keys are required: ".concat(["start","end","from","to"].join(", "),".");if(e.end>t.start||e.end<0||-1!=t.end&&t.start>=t.end)throw console.error("Given start and end compute error: ".concat(t.start,", ").concat(t.end)),"Given start and end compute error";return t})})}}]),e}(),p=function e(t){a(this,e),this.spec=t};e.exports=d},function(t,n){t.exports=e},function(e,t){e.exports=function(e,t,n){for(var r=0,o=e.length-1,i=Math.floor((r+o)/2),a=n(e[i],t);0!==a&&r<o;)a<0?o=i-1:r=i+1,a=n(e[i=Math.floor((r+o)/2)],t);return 0!==n(e[i],t)?-1:i}},function(e,t,n){var r=n(0),o=n(1),i=n(10);e.exports={Note:o,NoteObject:r,Keynotes:i}},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t){var n={easeInQuad:function(e,t,n,r){return n*(e/=r)*e+t},easeOutQuad:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeInOutQuad:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,n,r){return n*(e/=r)*e*e+t},easeOutCubic:function(e,t,n,r){return n*((e=e/r-1)*e*e+1)+t},easeInOutCubic:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t},easeInQuart:function(e,t,n,r){return n*(e/=r)*e*e*e+t},easeOutQuart:function(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t},easeInQuint:function(e,t,n,r){return n*(e/=r)*e*e*e*e+t},easeOutQuint:function(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},easeInSine:function(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t},easeOutSine:function(e,t,n,r){return n*Math.sin(e/r*(Math.PI/2))+t},easeInOutSine:function(e,t,n,r){return-n/2*(Math.cos(Math.PI*e/r)-1)+t},easeInExpo:function(e,t,n,r){return 0==e?t:n*Math.pow(2,10*(e/r-1))+t},easeOutExpo:function(e,t,n,r){return e==r?t+n:n*(1-Math.pow(2,-10*e/r))+t},easeInOutExpo:function(e,t,n,r){return 0==e?t:e==r?t+n:(e/=r/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(2-Math.pow(2,-10*--e))+t},easeInCirc:function(e,t,n,r){return-n*(Math.sqrt(1-(e/=r)*e)-1)+t},easeOutCirc:function(e,t,n,r){return n*Math.sqrt(1-(e=e/r-1)*e)+t},easeInOutCirc:function(e,t,n,r){return(e/=r/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeInElastic:function(e,t,n,r){var o=1.70158,i=0,a=n;if(0==e)return t;if(1==(e/=r))return t+n;if(i||(i=.3*r),a<Math.abs(n)){a=n;o=i/4}else o=i/(2*Math.PI)*Math.asin(n/a);return-a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/i)+t},easeOutElastic:function(e,t,n,r){var o=1.70158,i=0,a=n;if(0==e)return t;if(1==(e/=r))return t+n;if(i||(i=.3*r),a<Math.abs(n)){a=n;o=i/4}else o=i/(2*Math.PI)*Math.asin(n/a);return a*Math.pow(2,-10*e)*Math.sin((e*r-o)*(2*Math.PI)/i)+n+t},easeInOutElastic:function(e,t,n,r){var o=1.70158,i=0,a=n;if(0==e)return t;if(2==(e/=r/2))return t+n;if(i||(i=r*(.3*1.5)),a<Math.abs(n)){a=n;o=i/4}else o=i/(2*Math.PI)*Math.asin(n/a);return e<1?a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/i)*-.5+t:a*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/i)*.5+n+t},easeInBack:function(e,t,n,r){var o=1.70158;return n*(e/=r)*e*((o+1)*e-o)+t},easeOutBack:function(e,t,n,r){var o=1.70158;return n*((e=e/r-1)*e*((o+1)*e+o)+1)+t},easeInOutBack:function(e,t,n,r){var o=1.70158;return(e/=r/2)<1?n/2*(e*e*((1+(o*=1.525))*e-o))+t:n/2*((e-=2)*e*((1+(o*=1.525))*e+o)+2)+t},easeInBounce:function(e,t,n,r){return n-easeOutBounce(r-e,0,n,r)+t},easeOutBounce:function(e,t,n,r){return(e/=r)<1/2.75?n*(7.5625*e*e)+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOutBounce:function(e,t,n,r){return e<r/2?.5*easeInBounce(2*e,0,n,r)+t:.5*easeOutBounce(2*e-r,0,n,r)+.5*n+t},linear:function(e,t,n,r){return t+n*e/r}};e.exports=n},function(e,t,n){function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=n(2),s=n(11),u=n(12),c=n(13),f=n(3),l=n(0),h=n(1),d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.note_objects={},this.notes={},this.note_order=[],this.time=0,this.current_animation={start_time:0,journey_extract_to:2,journey_duration:0,journey_tree:[],journey:[],journey_segment_counter:[],forward:!0,note:null,lock:!1,recent_journey:null,afterAnimation:function(){}},this.recent_note=null}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(e,[{key:"getNoteObject",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.note_objects.hasOwnProperty(e))return this.note_objects[e];if(t)throw console.error("note object not found: ".concat(e)),"note object not found";return null}},{key:"addNoteObject",value:function(e,t){if(null!==this.getNoteObject(e,!1))throw console.error("duplicated note object name"),"duplicated note object name";var n=new l(e,t);return this.note_objects[e]=n,n}},{key:"addNote",value:function(e,t){var n=t.object_options,r=t.beforeBuild,o=t.afterDestroy;if(this.notes.hasOwnProperty(e))throw console.error("duplicated note name"),"duplicated note name";var i=new h(e,{object_options:n,beforeBuild:r,afterDestroy:o});return this.notes[e]=i,i}},{key:"setNoteOrder",value:function(e){var t=this;if(!Array.isArray(e)||e.filter(function(e){return!(e instanceof l||u(e))}).length>0)throw console.error("Order should be passed as array of Note instance or note name(String)"),"Order should be passed as array of Note instance or note name(String)";var n={};this.note_order=e.map(function(e){var r=String(e);if(n.hasOwnProperty(r))throw console.error("Given note name was duplicated in list"),"Given note name was duplicated in list";if(t.notes.hasOwnProperty(r))return n[r]=1,t.findNoteByName(r);throw console.error("Given note name doesn't exist"),"Given note name doesn't exist"})}},{key:"startNote",value:function(e,t){void 0!==t&&null!==t&&s(t)?(t.hasOwnProperty("beforeAnimation")||(t=r({},t,{beforeAnimation:function(){}})),t.hasOwnProperty("afterAnimation")||(t=r({},t,{afterAnimation:function(){}})),this._startNote(e,t)):this._startNote(e,{beforeAnimation:function(){},afterAnimation:function(){}})}},{key:"_startNote",value:function(e,t){var n=t.beforeAnimation,o=void 0===n?function(){}:n,i=t.afterAnimation,s=void 0===i?function(){}:i,u=String(e),c=this.findNoteByName(u);if(Array.prototype.indexOf.call(this.note_order,c)<0)throw console.error("Requested Note was not registered. Call setNoteOrder before it."),"Requested Note was not registered. Call setNoteOrder before it.";if(this.current_animation.lock)return!1;if(null===this.recent_note){Array.prototype.indexOf.call(this.note_order,c);a(o)&&o(),this.current_animation=r({},this.current_animation,{start_time:this.time,journey:[],journey_duration:0,journey_tree:[],journey_segment_counter:[],forward:!0,note:c,lock:!0,afterAnimation:s})}else{var f=Array.prototype.indexOf.call(this.note_order,this.recent_note),l=Array.prototype.indexOf.call(this.note_order,c),h=[],d=[],p=f<l;a(o)&&o(),d=p?(h=this.note_order.filter(function(e,t){return f<t&&t<l})).map(function(e){return 0}):(h=this.note_order.filter(function(e,t){return l<=t&&t<=f}).reverse()).map(function(e){return 0}),this.current_animation=r({},this.current_animation,{start_time:this.time,journey:h},this.calculateJourneyDuration(h,this.current_animation.journey_extract_to),{journey_segment_counter:d,forward:p,note:c,lock:!0,afterAnimation:s})}}},{key:"calculateJourneyDuration",value:function(e,t){for(var n=e.reduce(function(e,t){return e+t.transition_duration},0),r=e.map(function(e){return e.transition_duration/n*t}),o=[0],i=0;i<r.length;i++)o.push(o[i]+r[i]);for(var a=[],s=0;s<o.length-1;s++)a.push({start:o[s],end:o[s+1]});return{journey_duration:n,journey_tree:a}}},{key:"findNoteByName",value:function(e){var t=c(this.notes,function(t){return t.toString()===e});if(void 0===t)throw console.error("Note not found(".concat(e,"). Check if it was made without Keynote object or mispell note name.")),"Note not found(".concat(e,"). Check if it was made without Keynote object or mispell note name.");return t}},{key:"seekUntil",value:function(e,t,n,r){var o=t.getSegmentIdx(n);if(e)for(var i=0;i<o&&-1!=t.segments[i].end;i++)t.seek(t.segments[i].end-1e-5,r);else for(var a=t.segments.length-1;a>o;a--)-1!=t.segments[a].end&&t.seek(t.segments[a].start,r);t.seek(n,r)}},{key:"visitUnprocessedSegmentsOfJourney",value:function(e){for(var t=this.current_animation,n=t.forward,r=t.journey,o=t.journey_segment_counter,i=o.slice(),a=0;a<e;a++){var s=r[a].segments.filter(function(e){return-1!=e.end});o[a]<s.length&&(this.seekUntil(n,r[a],n?r[a].transition_duration-1e-5:0,this.note_objects),i[a]=s.length)}this.current_animation.journey_segment_counter=i}},{key:"render",value:function(e){this.time=e;var t=this.current_animation,n=t.start_time,r=t.journey_extract_to,o=t.journey,i=t.journey_duration,a=t.journey_tree,s=(t.journey_segment_counter,t.forward),u=t.note,c=t.lock,l=t.recent_journey,d=t.afterAnimation,p=this.time-n;if(null===u||!(u instanceof h))throw console.error("Animation target note should be Note instance"),"Animation target note should be Note instance";if(c)if(o.length>0&&p<=r){var y=f(a,p,function(e,t){var n=e.start,r=e.end;return n<=t&&t<=r?0:t<n?-1:1});(l instanceof h&&l!==o[y-(s?1:-1)]||0!==y)&&console.log(o.map(function(e){return e.name}),l.name,y);var m=0;m=s?(p-a[y].start)*(i/r):o[y].transition_duration-(p-a[y].start)*(i/r),o[y]!==l&&(l instanceof h&&(l.seek(s?l.transition_duration-1e-5:0,this.note_objects),l.afterDestroy(s)),o[y].beforeBuild(s),this.current_animation.recent_journey=o[y]),o[y].seek(m,this.note_objects)}else{u!==l&&(l instanceof h&&(l.seek(s?l.transition_duration-1e-5:0,this.note_objects),l.afterDestroy(s)),u.beforeBuild(s),this.current_animation.recent_journey=u);var b=p-(o.length>0?r:0);b>=u.transition_duration&&(this.recent_note=u,this.current_animation.lock=!1,d()),u.seek(b,this.note_objects)}else u!==l&&(l instanceof h&&(l.seek(s?l.transition_duration-1e-5:0,this.note_objects),l.afterDestroy(s)),u.beforeBuild(s),this.current_animation.recent_journey=u),u.seek(p-(o.length>0?r:0),this.note_objects)}}]),e}();e.exports=d},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t){e.exports=s}])});
//# sourceMappingURL=keynotes.js.map